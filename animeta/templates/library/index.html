{% extends 'library/_base.html' %}

{% block library_content %}
<div id="app-root"></div>

{% raw %}
<script type="text/x-handlebars" data-template-name="components/item-status">
    {{#if isWatching}}
        {{#if hasProgress}}
            {{progressText}}
        {{else}}
            {{statusText}}
        {{/if}}
    {{else}}
        {{statusText}}
        {{#if hasProgress}}
            <span class="progress-muted">@ {{progressText}}</span>
        {{/if}}
    {{/if}}
</script>

<script type="text/x-handlebars" data-template-name="library">
<p>작품이 {{length}}개 등록되어 있습니다.</p>

{{outlet}}

<div class="library-item-list">
{{#each sectionedContents}}
    <div class="group">
        <h2>{{header}}</h2>
        <ul>
        {{#each items}}
            <li {{bind-attr class=":item status"}}>
                {{#link-to 'library.item' this}}
                    {{title}}
                    {{item-status status=status progress=progress}}
                {{/link-to}}
            </li>
        {{/each}}
        </ul>
    </div>
{{/each}}
</div>
</script>

<script type="text/x-handlebars" data-template-name="library/item">
<h1>{{title}}</h1>
<button {{action 'close'}}>Close</button>
</script>
{% endraw %}
{% endblock %}

{% block js %}
{{ super() }}
<script type="text/javascript" src="{{ url_for('static', filename='js/handlebars-1.0.0.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/ember-1.0.0.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/moment.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/library.js') }}"></script>
<script>
App.DATA_ITEMS = {{ items|serialize }}.map(function(data) {
    data.updated_at = new Date(data.updated_at * 1000);
    return App.LibraryItem.create(data);
});
</script>
{% endblock %}
